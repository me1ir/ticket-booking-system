{% extends 'tickets/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">–î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

    <div class="card">
        <div class="card-body">
            <h4 class="card-title">{{ booking.showtime.movie.title }}</h4>
            <p class="card-text">
                <strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong> {{ booking.showtime.start_time|date:"d.m.Y H:i" }}<br>
                <strong>–ó–∞–ª:</strong> {{ booking.showtime.hall.name }}<br>
                <strong>–ú–µ—Å—Ç–∞:</strong>
                {% for ticket in booking.tickets.all %}
                    <span class="badge bg-light text-dark border me-1">
                        üéüÔ∏è –†—è–¥ {{ ticket.seat.row }} –ú–µ—Å—Ç–æ {{ ticket.seat.number }}
                        {% if ticket.ticket_type == "adult" %}üë§ –í–∑—Ä–æ—Å–ª—ã–π{% endif %}
                        {% if ticket.ticket_type == "student" %}üéì –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π{% endif %}
                        {% if ticket.ticket_type == "child" %}üë∂ –î–µ—Ç—Å–∫–∏–π{% endif %}
                    </span>
                {% empty %}
                    <span class="text-muted">–ù–µ –≤—ã–±—Ä–∞–Ω—ã</span>
                {% endfor %}<br>
                <strong>–°—É–º–º–∞:</strong> {{ booking.total_price }} ‚Ç∏<br>
                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                {% if booking.is_refunded %}
                    <span class="text-danger">–í–æ–∑–≤—Ä–∞—â—ë–Ω</span>
                {% else %}
                    <span class="text-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                {% endif %}
            </p>

            {% if booking.qr_code %}
                <div class="mt-4">
                    <h5>QR-–∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞:</h5>
                    <img src="{{ booking.qr_code.url }}" alt="QR –∫–æ–¥" class="img-fluid" style="max-width: 200px;">
                </div>
            {% endif %}
        </div>
    </div>

    {% with cinema=booking.showtime.hall.cinema %}
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞: {{ cinema.name }}</h5>
                <p class="card-text">{{ cinema.address }}</p>
                <div class="rounded shadow-sm border">
                    <iframe
                        src="https://yandex.kz/map-widget/v1/?ll={{ cinema.longitude }},{{ cinema.latitude }}&z=14&l=map&pt={{ cinema.longitude }},{{ cinema.latitude }},pm2rdm"
                        width="100%" height="300" frameborder="0" style="border:0;" allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
    {% endwith %}

    <div class="text-center mt-4">
        <a href="{% url 'user-bookings' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –º–æ–∏–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º</a>
    </div>
</div>
{% endblock %}
